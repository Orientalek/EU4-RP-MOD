namespace = incident_generic

### PU Subject joins HRE ###

country_event = {
	id = incident_generic.1
	title = incident_pu_subject_joins_empire
	desc = incident_generic.1.d
	picture = GOOD_WITH_MONARCH_eventPicture

	trigger = {
		has_dlc = "Emperor"
		NOT = { active_imperial_incident = any }
		is_part_of_hre = yes
		is_emperor = no
		NOT = {
			any_country = {
				has_country_flag = current_pu_incident_target_flag
			}
		}
		any_subject_country = {
			years_in_union_under = {
				who = ROOT
				years = 20
			}
			is_part_of_hre = no
			NOT = { has_country_flag = pu_hre_rejected_flag }
			NOT = { has_country_flag = current_pu_incident_target_flag }
			any_owned_province = {
				OR = {
					is_part_of_hre = yes
					any_neighbor_province = {
						is_part_of_hre = yes
					}
				}
			}
			NOT = { num_of_cities = ROOT } # prevents huge countries from joining
			NOT = { tag = PAP } # this shouldn't happen but let's be super safe
		}
	}
	
	mean_time_to_happen = {
		months = 120
	}
	
	immediate = {
		hidden_effect = {
			random_subject_country = {
				limit = {
					years_in_union_under = {
						who = ROOT
						years = 20
					}
					is_part_of_hre = no
					NOT = { has_country_flag = pu_hre_rejected_flag }
					NOT = { has_country_flag = current_pu_incident_target_flag }
					any_owned_province = {
						OR = {
							is_part_of_hre = yes
							any_neighbor_province = {
								is_part_of_hre = yes
							}
						}
					}
					NOT = { num_of_cities = ROOT }
					NOT = { tag = PAP }
				}
				set_country_flag = current_pu_incident_target_flag
				save_event_target_as = pu_hre_country
			}
		}
	}
	
	option = {
		name = incident_generic.1.a
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				event_target:pu_hre_country = {
					tag = HUN
				}
			}
		}
		set_imperial_incident = incident_pu_subject_joins_empire
		event_target:pu_hre_country = {
			add_opinion = {
				who = ROOT
				modifier = petitioned_for_hre_membership
			}
		}
	}
	
	option = {
		name = incident_generic.1.b
		ai_chance = {
			factor = 1
		}
		event_target:pu_hre_country = {
			set_country_flag = pu_hre_rejected_flag
		}
		add_prestige = -5
		custom_tooltip = reject_hre_pu_tt # PU will never have this chance again
		event_target:pu_hre_country = {
			clr_country_flag = current_pu_incident_target_flag
			add_opinion = {
				who = ROOT
				modifier = no_petition_for_hre_membership
			}
		}
	}
}

# Mock incident 
country_event = {
	id = incident_generic.2
	title = incident_generic.2.t
	desc = incident_generic.2.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	
	immediate = {
		hidden_effect = {
			random_country = {
				limit = {
					has_country_flag = current_pu_incident_target_flag
				}
				save_event_target_as = current_pu_incident_target
			}
		}
	}
	
	option = { # allow junior partner to join
		name = incident_generic.2.a
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				OR = {
					is_rival = FROM
					FROM = { is_rival = ROOT }
				}
			}
		}
		event_target:current_pu_incident_target = {
			set_in_empire = yes
			overlord = {
				add_opinion = {
					who = ROOT
					modifier = opinion_added_pu_subject_hre
				}
			}
		}
	}
	
	option = { # reject application
		name = incident_generic.2.b
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1000
				OR = {
					is_rival = FROM
					FROM = { is_rival = ROOT }
				}
			}
		}
		event_target:current_pu_incident_target = {
			set_country_flag = pu_hre_rejected_flag
			overlord = {
				add_opinion = {
					who = ROOT
					modifier = opinion_denied_pu_subject_hre
				}
			}
		}
	}
	
	after = {
		event_target:current_pu_incident_target = {
			clr_country_flag = current_pu_incident_target_flag
		}
	}
}


country_event = {
	id = incident_generic.3
	title = incident_generic.3.t
	desc = incident_generic.3.d
	picture = HRE_eventPicture

	major = yes

	trigger = {
		has_dlc = "Emperor"
		NOT = { active_imperial_incident = any }
		is_part_of_hre = no
		is_emperor = no
		NOT = {
			any_country = {
				has_country_flag = current_incident_subject_incident_target_flag
			}
		}
		any_subject_country = {
			is_part_of_hre = yes
			is_subject = yes
			is_elector = yes
			overlord = {
				is_emperor = no
			}
			NOT = { has_country_flag = current_incident_subject_remain_elector}
			NOT = { has_country_flag = subject_remain_elector_after_war}


	}

	}
	mean_time_to_happen = {
		months = 1
	}
		immediate = {
		hidden_effect = {
			random_subject_country = {
				limit = {
					is_part_of_hre = yes
					is_emperor = no
					is_subject = yes
					is_elector = yes
					NOT = { has_country_flag = current_incident_subject_remain_elector }
					NOT = { has_country_flag = current_incident_subject_incident_target_flag }
				}
				set_country_flag = current_incident_subject_incident_target_flag
				save_event_target_as = subject_elector
			}
		}
	}
	option = {
		name = incident_generic.3.a
		ai_chance = {
			factor = 10
		}
		set_imperial_incident = incident_elector_is_subject
	}
	

}
country_event = {
	id = incident_generic.4
	title = incident_generic.4.t
	desc = incident_generic.4.d
	picture = HRE_eventPicture
	is_triggered_only = yes


	immediate = {
		hidden_effect = {
			random_country = {
				limit = {
					has_country_flag = current_incident_subject_incident_target_flag
				}
				save_event_target_as = subject_elector
			}
			
		
	
			}
	}

	option = {
		name = incident_generic.4.a #zadanie wyzwolenia
		ai_chance = {
			factor = 10
		}
			random_known_country = {
			limit = {
				overlord_of = event_target:subject_elector
			}
			country_event = {
				id = incident_generic.5
			}
			}
		
		
	}
	option = {
		name = incident_generic.4.b #odebranie elektora
		ai_chance = {
			factor = 10
		}
		event_target:subject_elector = {
				elector = no
				clr_country_flag = current_incident_subject_incident_target_flag
		}
		emperor = {
				every_known_country = {
					limit = {
						is_elector = yes
						is_emperor = no
						
					}
					add_opinion = {
					who = emperor
					modifier = remove_elector_relation
					}
				}
				add_country_modifier = { 
				name = "remove_elector"
				duration = 3650
				}

		}
		
		add_imperial_influence = -10
		
	}
	option = {
		name = incident_generic.4.c #nic
		ai_chance = {
			factor = 10
		}
		event_target:subject_elector = {
			clr_country_flag = current_incident_subject_incident_target_flag
		}
			
		
		event_target:subject_elector = {
				set_country_flag = current_incident_subject_remain_elector
				clr_country_flag = current_incident_subject_incident_target_flag
				}
		add_imperial_influence = -5
	}
}
country_event = {
	id = incident_generic.5
	title = incident_generic.5.t
	desc = incident_generic.5.d
	picture = HRE_eventPicture
	is_triggered_only = yes

		immediate = {
		hidden_effect = {
			
			random_country = {
				limit = {
					has_country_flag = current_incident_subject_incident_target_flag
				}
				save_event_target_as = subject_elector
			}
		}
	}

	option = {
		name = incident_generic.5.a #wyzwolenie
		ai_chance = {
			factor = 100
		}
		event_target:subject_elector = {
			
					grant_independence = yes	
			}
		
		
	}
	option = {
		name = incident_generic.5.b #a wiec wojna!
		ai_chance = {
			factor = 10
		}
		emperor = {
			declare_war_with_cb = {
				who = ROOT
				casus_belli = cb_liberation
			}
		}
		event_target:subject_elector = {
				set_country_flag = subject_remain_elector_after_war
		}
		
	}	
	
	after = {
		event_target:subject_elector = {
			clr_country_flag = current_incident_subject_incident_target_flag
		}
	}
}
	country_event = {
	id = incident_generic.6
	title = incident_generic.6.t
	desc = incident_generic.6.d
	picture = GOOD_WITH_MONARCH_eventPicture
	trigger = {
				has_country_flag = subject_remain_elector_after_war
				is_subject = no
	}
	option = {
		name = incident_generic.6.a #wyzwolenie
		ai_chance = {
			factor = 100
		}
		clr_country_flag = subject_remain_elector_after_war
	}
	
	}
	country_event = {
		id = incident_generic.7
		title = incident_generic.7.t
		desc = incident_generic.7.d
		picture = HRE_eventPicture
		is_triggered_only = yes

		option = {
			name = incident_generic.7.a
			set_imperial_incident = incident_netherlands
		}
	}
	country_event = {
		id = incident_generic.8
		title = incident_generic.8.t
		desc = incident_generic.8.d
		picture = HRE_eventPicture
		is_triggered_only = yes

		option = {
			name = incident_generic.8.a

			NED = {
				country_event = {
					id = incident_generic.9
				}
			}
		}
		option = {
			name = incident_generic.8.b
			NED = {
				set_in_empire = no
				hidden_effect = {
					every_owned_province = {
						limit = {
							is_part_of_hre = yes
						}
						set_in_empire = no
					}
				}
			}
		}
	}
	country_event = {
		id = incident_generic.9
		title = incident_generic.9.t
		desc = incident_generic.9.d
		picture = HRE_eventPicture
		is_triggered_only = yes

		option = {
			name = incident_generic.9.a
			set_in_empire = no
				hidden_effect = {
					every_owned_province = {
						limit = {
							is_part_of_hre = yes
						}
						set_in_empire = no
					}
				}
			emperor = {
				add_casus_belli = {
    				target = NED
    				type = cb_force_join_hre
   					 months = 120
				}
			}
		}
		option = {
			name = incident_generic.9.b
			add_prestige = -5
		}
	}
	country_event = {
		id = incident_generic.10
		title = incident_generic.10.t
		desc = incident_generic.10.d
		picture = HRE_eventPicture
		is_triggered_only = yes
		major = yes
		option = {
			name = incident_generic.10.a
			set_imperial_incident = incident_teutons
		}
	}
	country_event = {
		id = incident_generic.11
		title = incident_generic.11.t
		desc = incident_generic.11.d
		picture = HRE_eventPicture
		is_triggered_only = yes

		option = {
			name = incident_generic.11.a
			TEU = {
				set_in_empire = yes
			}
			hidden_effect = {
				TEU = {
					country_event = {
						id = eastern.17
					}
				}
			}
		}
		
		option = {
			name = incident_generic.11.b
			
		}
	}
